---
title: Streaming with JSONLinesResponder Object
description: Streaming with JSONLinesResponder instance for more control over the stream
---

import { Tabs } from 'nextra/components';
import JSONLinesResponderExample from './JSONLinesResponderExample';
import Example from '@/components/Example';

# Streaming with JSONLinesResponder Object

This example uses [JSONLinesResponder](https://vovk.dev/jsonlines#jsonlinesresponder) object in order to get more control over the stream logic.

## Result

<Example>
  <JSONLinesResponderExample />
</Example>

## Code

<Tabs items={['JSONLinesResponderService.ts', 'JSONLinesResponderController.ts', 'JSONLinesResponderExample.tsx']}>
  <Tabs.Tab>
```ts showLineNumbers copy filename="src/modules/jsonlines-responder/JSONLinesResponderService.ts" repository="finom/vovk-examples"
import type { JSONLinesResponder } from 'vovk';

export type Token = { message: string };

export default class JSONLinesResponderService {
  static async streamTokens(resp: JSONLinesResponder<Token>) {
    const tokens: Token[] = [
      { message: 'Hello,' },
      { message: ' World' },
      { message: ' from' },
      { message: ' JSONLines' },
      { message: ' Endpoint' },
      { message: ' that' },
      { message: ' uses' },
      { message: ' JSONLines' },
      { message: 'Response' },
      { message: ' instance' },
      { message: '!' },
    ];

    for (const token of tokens) {
      resp.send(token);
      await new Promise((resolve) => setTimeout(resolve, 300));
    }

    await resp.close();
  }
}
```
*[The code above is fetched from GitHub repository.](https://github.com/finom/vovk-examples/blob/main/src/modules/jsonlines-responder/JSONLinesResponderService.ts)*
  </Tabs.Tab>
  <Tabs.Tab>
```ts showLineNumbers copy filename="src/modules/jsonlines-responder/JSONLinesResponderController.ts" repository="finom/vovk-examples"
import { prefix, get, operation, JSONLinesResponder } from 'vovk';
import JSONLinesResponderService, { type Token } from './JSONLinesResponderService.ts';

@prefix('jsonlines-responder')
export default class JSONLinesResponseController {
  @operation({
    summary: 'Stream tokens using Response object',
    description: 'Stream tokens to the client using Response object',
  })
  @get('tokens', { cors: true }) // CORS for OPTIONS Next.js route handler
  static async streamTokens(req: Request) {
    const response = new JSONLinesResponder<Token>(req, ({ headers, readableStream }) => new Response(readableStream, {
      headers: {
        // CORS for GET
        'Access-Control-Allow-Origin': 'https://vovk.dev',
        'Access-Control-Allow-Methods': 'GET',
        'Access-Control-Allow-Headers': 'Authorization',
        ...headers,
      },
    }));

    void JSONLinesResponderService.streamTokens(response);

    return response;
  }
}
```
*[The code above is fetched from GitHub repository.](https://github.com/finom/vovk-examples/blob/main/src/modules/jsonlines-responder/JSONLinesResponderController.ts)*

  </Tabs.Tab>
  <Tabs.Tab>
```tsx showLineNumbers copy filename="src/app/jsonlines-responder/JSONLinesResponderExample.tsx" repository="finom/vovk-examples"
'use client';
import { useState } from 'react';
import { JSONLinesResponderRPC } from '@/client';
import type { VovkYieldType } from 'vovk';

export default function StreamExample() {
  const [tokens, setTokens] = useState<VovkYieldType<typeof JSONLinesResponderRPC.streamTokens>[]>([]);
  return (
    <>
      <button
        onClick={async () => {
          setTokens([]);
          using stream = await JSONLinesResponderRPC.streamTokens();
          for await (const token of stream) {
            setTokens((tokens) => [...tokens, token]);
          }
        }}
      >
        Get JSON Lines response
      </button>
      <div>
        {tokens.map(({ message }, i) => (
          <span key={i}>{message}</span>
        ))}
      </div>
    </>
  );
}
```
*[The code above is fetched from GitHub repository.](https://github.com/finom/vovk-examples/blob/main/src/app/jsonlines-responder/JSONLinesResponderExample.tsx)*
  </Tabs.Tab>
</Tabs>


## Related Documentation

- [JSONLines](https://vovk.dev/jsonlines)
- [TypeScript RPC](https://vovk.dev/typescript)
- [Controller & Procedure](https://vovk.dev/procedure)
- [`@operation` Decorator](https://vovk.dev/openapi)

